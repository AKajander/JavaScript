<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script>
	var urlStations = "https://rata.digitraffic.fi/api/v1/metadata/stations";
	var xmlhttpStations = new XMLHttpRequest();
	xmlhttpStations.open("GET", urlStations, true);
	xmlhttpStations.send();

	xmlhttpStations.onreadystatechange = function() {
		if (xmlhttpStations.readyState == 4 && xmlhttpStations.status == 200) {
			// Receive the response as JSON and parse it into a JS variable
			jsonStations = JSON.parse(xmlhttpStations.responseText);

			// Now received JSON can be used as a JS variable
			// Stored in data variable

			var stationDataDeparture = jsonStations;
	// Loop that run through JSON data array and all data will be collected to out variable
			var stationOut = "<form>";
			stationOut += '<select id="departure-station">';

			for (var i=0; i < stationDataDeparture.length; i++) {
		// For each loop round, we will create a new table for <tr> -tag and append (+=)
		// the data to existing out variable
		// For each cell, we will output data fields from JSON
				stationOut += '<option>' + stationDataDeparture[i].stationShortCode + " " + stationDataDeparture[i].stationName + '</option>';
			}

			stationOut += '</select>';
			stationOut+="</form>";

			document.getElementById("station-data-departure").innerHTML = stationOut;

			var stationDataArrive = jsonStations;
	// Loop that run through JSON data array and all data will be collected to out variable
			var stationOut = "<form>";
			stationOut += '<select id="arrive-station">';

			for (var i=0; i < stationDataArrive.length; i++) {
		// For each loop round, we will create a new table for <tr> -tag and append (+=)
		// the data to existing out variable
		// For each cell, we will output data fields from JSON
				stationOut += '<option>' + stationDataArrive[i].stationShortCode + " " + stationDataArrive[i].stationName + '</option>';
			}

			stationOut += '</select>';
			stationOut += "</form>";

			document.getElementById("station-data-arrive").innerHTML = stationOut;
		}
	}

	function searchTrains() {
		var departureStation = document.getElementById("departure-station").value;
		var arriveStation = document.getElementById("arrive-station").value;
		var urlTrains = "https://rata.digitraffic.fi/api/v1/live-trains/station/" + departureStation + "/" + arriveStation + "?include_nonstopping=false&limit=1";
		var xmlhttpTrains = new XMLHttpRequest();
		xmlhttpTrains.open("GET", urlTrains, true);
		xmlhttpTrains.send();

		xmlhttpTrains.onreadystatechange = function() {
			if (xmlhttpTrains.readyState == 4 && xmlhttpTrains.status == 200) {
				// Receive the response as JSON and parse it into a JS variable
				jsonTrains = JSON.parse(xmlhttpTrains.responseText);

				// Now received JSON can be used as a JS variable
				// Stored in data variable

				var trainData = jsonTrains;
				// Loop that run through JSON data array and all data will be collected to out variable
				var trainOut = "<ul>";
				trainOut += '<li>';

				for (var i=0; i < trainData.length; i++) {
				// For each loop round, we will create a new table for <tr> -tag and append (+=)
				// the data to existing out variable
				// For each cell, we will output data fields from JSON
					trainOut += '<li>' + trainData[i].commuterLineId + '</li>';
			}

			trainOut += '</li>';
			trainOut += "</ul>";

			document.getElementById("trains-data").innerHTML = trainOut;
		}
	}
}

</script>
</head>
<body>
<header class="header header--transparent">
<div class="content">
	<div class="row">
		<div class="col-xs-6">
		</div>
	</div>
</div>
<body>
<content>
	<section>
		<div>
			<div class="row">
				<div class="col-xs">


				</div>
			</div>
		</div>
	</section>
	<section>
		<div id="station-data-departure">
			<div class="row">
				<div class="col-xs">
					<form>

					</form>
				</div>
			</div>
		</div>
	</section>
	<section>
		<div id="station-data-arrive">
			<div class="row">
				<div class="col-xs">
					<form>
					</form>
				</div>
			</div>
		</div>
	</section>
	<section>
		<div>
			<div class="row">
				<div class="col-xs">
					<form>
						<input type="button" value="Search" onclick="searchTrains()">
					</form>
				</div>
			</div>
		</div>
	</section>
	<section>
		<div id="trains-data">
			<div class="row">
				<div class="col-xs">
					<div id="content">
					</div>
				</div>
			</div>
		</div>
	</section>
</content>
</body>
</html>

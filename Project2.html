<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script>

	// Get stations list from rata.digitraffic.fi and show them in dropdownlist (two dropdownlists for departure and arrive)

	var urlStations = "https://rata.digitraffic.fi/api/v1/metadata/stations";
	var xmlhttpStations = new XMLHttpRequest();
	xmlhttpStations.open("GET", urlStations, true);
	xmlhttpStations.send();

	xmlhttpStations.onreadystatechange = function() {
		if (xmlhttpStations.readyState == 4 && xmlhttpStations.status == 200) {

			// Receive the response as JSON and parse it into a JS variable
			jsonStations = JSON.parse(xmlhttpStations.responseText);

			// Store in data variable
			var stationDataDeparture = jsonStations;

			// Loop through JSON data array and all data will be collected to stationOut variable
			var stationOut = "<form>";
			stationOut += '<select>';

			for (var i=0; i < stationDataDeparture.length; i++) {

				// Each loop round will create a new option for select tag and append to stationOut variable
				stationOut += '<option  id="departure-station">' + stationDataDeparture[i].stationShortCode + " " + stationDataDeparture[i].stationName + '</option>';
			}

			stationOut += '</select>';
			stationOut+="</form>";

			document.getElementById("station-data-departure").innerHTML = stationOut;

			var stationDataArrive = jsonStations;

			// Loop through JSON data array and all data will be collected to stationOut variable
			var stationOut = "<form>";
			stationOut += '<select>';

			for (var i=0; i < stationDataArrive.length; i++) {
				// Each loop round will create a new option for select tag and append to stationOut variable
				stationOut += '<option  id="arrive-station">' + stationDataArrive[i].stationShortCode + " " + stationDataArrive[i].stationName + '</option>';
			}

			stationOut += '</select>';
			stationOut += "</form>";

			document.getElementById("station-data-arrive").innerHTML = stationOut;
	}
}


// jQuery datepicker and today's date is default

$( function() {
	$("#datepicker").datepicker().datepicker("setDate", new Date());
} );


// Pick chosen date and use in url BUT IT DOESN'T WORK AND I CAN'T FIND THE REASON WHY

//var date = document.getElementById("datepicker").value;
var trainsByDateUrl = "https://rata.digitraffic.fi/api/v1/metadata/train-types";


// jQuery ajax is used to get trains by date

$("get-trains-by-date-button").click(function(){
	$.ajax({
		url: trainsByDateUrl,
		success: function(result){
  	$("#trains-result").html(result);
	}});
});


// Get stations list from rata.digitraffic.fi and show them in dropdownlist (two dropdownlists for departure and arrive)

var xmlhttpTrains = new XMLHttpRequest();
xmlhttpTrains.open("GET", trainsByDateUrl, true);
xmlhttpTrains.send();

xmlhttpTrains.onreadystatechange = function() {
	if (xmlhttpTrains.readyState == 4 && xmlhttpTrains.status == 200) {

		// Receive the response as JSON and parse it into a JS variable
		jsonTrains = JSON.parse(xmlhttpTrains.responseText);

		// Store in data variable
		var trainData = jsonTrains;

		// Loop through JSON data array and all data will be collected to stationOut variable
		var trainOut = "<table>";

		for (var i=0; i < trainData.length; i++) {

			// Each loop round will create a new option for tr and td tags and append to stationOut variable
			trainOut += '<tr>';
			trainOut += '<td>' + trainData[i].name + '</td>';
			trainOut += '<td>&nbsp;&nbsp;&nbsp;&nbsp;</td>'
			trainOut += '<td>' + trainData[i].trainCategory.name + '</td>';
			trainOut += '</tr>';
		}

		trainOut += "</table>";

		document.getElementById("trains-data").innerHTML = trainOut;
		}
	}

</script>
</head>
<body>
	<div class="container-fluid">
			<h1 style="margin:100px">Trains <small> some information about trains.</small></h1>
	</div>
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
			</div>
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    </div>
  </div>
</nav>
<header class="header header--transparent">
	<div class="container">
	<div class="page-header">
		<div class="row">
			<div class="col-xs-6">
				<div>
					<div class="col-xs">
					</div>
				</div>
				<div>
					<h4><b>List of train stations <small> - there was meant to be a search where you can find trains operating between
					chosen stations but I can't save (stations) values into js variable.</small></b></h4>
					<div id="station-data-departure">
						<div class="col-xs">
						</div>
					</div>
				</div>
				<div id="station-data-arrive">
					<div class="col-xs">
					</div>
				</div>
			<div>
				<div class="col-xs">
					<form>
						<input id="get-trains-button" type="button" value="Search">
					</form>
				</div>
			</div>
		</div>
		<div class="row">
			<div>
				<div class="col-xs">
					<div id="content">
						<h4><b>Search trains by date <small> - there was meant to be a search where you can find trains operating at chosen
						time but I can't save the (date) value into js variable.</small></b></h4>
						<label>Choose date: </label>
						<input type="text" id="datepicker">
						<input id="get-trains-by-date-button" type="button" value="Search trains by date">
					</div>
				</div>
			</div>
			<div>
				<div class="col-xs">
					<div id="trains-result">
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div>
				<h4><b>Train types list <small> - lists any train types that are used at the moment</small></b></h4>
				<div id="trains-data">
				</div>
			</div>
		</div>
	</div>
</body>
</html>
